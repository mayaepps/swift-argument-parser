{"kind":"article","metadata":{"modules":[{"name":"ArgumentParser"}],"title":"Providing Custom Validation","role":"article","roleHeading":"Article"},"sections":[],"abstract":[{"text":"Provide helpful feedback to users when things go wrong.","type":"text"}],"hierarchy":{"paths":[["doc:\/\/ArgumentParser\/documentation\/ArgumentParser"]]},"seeAlsoSections":[{"title":"Validation and Errors","generated":true,"identifiers":["doc:\/\/ArgumentParser\/documentation\/ArgumentParser\/ValidationError","doc:\/\/ArgumentParser\/documentation\/ArgumentParser\/CleanExit","doc:\/\/ArgumentParser\/documentation\/ArgumentParser\/ExitCode"]}],"schemaVersion":{"major":0,"patch":0,"minor":3},"primaryContentSections":[{"kind":"content","content":[{"level":2,"type":"heading","anchor":"Overview","text":"Overview"},{"type":"paragraph","inlineContent":[{"text":"While ","type":"text"},{"type":"codeVoice","code":"ArgumentParser"},{"type":"text","text":" validates that the inputs given by your user match the requirements and types that you define in each command, there are some requirements that can’t easily be described in Swift’s type system, such as the number of elements in an array, or an expected integer value."}]},{"anchor":"Validating-Command-Line-Input","level":3,"type":"heading","text":"Validating Command-Line Input"},{"type":"paragraph","inlineContent":[{"type":"text","text":"To validate your commands properties after parsing, implement the "},{"isActive":true,"type":"reference","identifier":"doc:\/\/ArgumentParser\/documentation\/ArgumentParser\/ParsableArguments\/validate()-5r0ge"},{"text":" method on any ","type":"text"},{"identifier":"doc:\/\/ArgumentParser\/documentation\/ArgumentParser\/ParsableCommand","isActive":true,"type":"reference"},{"text":" or ","type":"text"},{"identifier":"doc:\/\/ArgumentParser\/documentation\/ArgumentParser\/ParsableArguments","type":"reference","isActive":true},{"type":"text","text":" type. Throwing an error from the "},{"type":"codeVoice","code":"validate()"},{"text":" method causes the program to print a message to standard error and exit with an error code, preventing the ","type":"text"},{"type":"codeVoice","code":"run()"},{"type":"text","text":" method from being called with invalid inputs."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Here’s a command that prints out one or more random elements from the list you provide. Its "},{"type":"codeVoice","code":"validate()"},{"text":" method catches three different errors that a user can make and throws a relevant error for each one.","type":"text"}]},{"type":"codeListing","syntax":"swift","code":["struct Select: ParsableCommand {","    @Option var count: Int = 1","    @Argument var elements: [String] = []","","    mutating func validate() throws {","        guard count >= 1 else {","            throw ValidationError(\"Please specify a 'count' of at least 1.\")","        }","","        guard !elements.isEmpty else {","            throw ValidationError(\"Please provide at least one element to choose from.\")","        }","","        guard count <= elements.count else {","            throw ValidationError(\"Please specify a 'count' less than the number of elements.\")","        }","    }","","    mutating func run() {","        print(elements.shuffled().prefix(count).joined(separator: \"\\n\"))","    }","}"]},{"type":"paragraph","inlineContent":[{"text":"When you provide useful error messages, they can guide new users to success with your command-line tool!","type":"text"}]},{"code":["% select","Error: Please provide at least one element to choose from.","Usage: select [--count <count>] [<elements> ...]","  See 'select --help' for more information.","% select --count 2 hello","Error: Please specify a 'count' less than the number of elements.","Usage: select [--count <count>] [<elements> ...]","  See 'select --help' for more information.","% select --count 0 hello hey hi howdy","Error: Please specify a 'count' of at least 1.","Usage: select [--count <count>] [<elements> ...]","  See 'select --help' for more information.","% select --count 2 hello hey hi howdy","howdy","hey"],"syntax":null,"type":"codeListing"},{"type":"heading","level":2,"anchor":"Handling-Post-Validation-Errors","text":"Handling Post-Validation Errors"},{"inlineContent":[{"text":"The ","type":"text"},{"identifier":"doc:\/\/ArgumentParser\/documentation\/ArgumentParser\/ValidationError","type":"reference","isActive":true},{"text":" type is a special ","type":"text"},{"type":"codeVoice","code":"ArgumentParser"},{"text":" error — a validation error’s message is always accompanied by an appropriate usage string. You can throw other errors, from either the ","type":"text"},{"code":"validate()","type":"codeVoice"},{"type":"text","text":" or "},{"type":"codeVoice","code":"run()"},{"text":" method to indicate that something has gone wrong that isn’t validation-specific. Errors that conform to ","type":"text"},{"type":"codeVoice","code":"CustomStringConvertible"},{"type":"text","text":" or "},{"code":"LocalizedError","type":"codeVoice"},{"type":"text","text":" provide the best experience for users."}],"type":"paragraph"},{"code":["struct LineCount: ParsableCommand {","    @Argument var file: String","","    mutating func run() throws {","        let contents = try String(contentsOfFile: file, encoding: .utf8)","        let lines = contents.split(separator: \"\\n\")","        print(lines.count)","    }","}"],"type":"codeListing","syntax":"swift"},{"inlineContent":[{"text":"The throwing ","type":"text"},{"type":"codeVoice","code":"String(contentsOfFile:encoding:)"},{"text":" initializer fails when the user specifies an invalid file. ","type":"text"},{"type":"codeVoice","code":"ArgumentParser"},{"type":"text","text":" prints its error message to standard error and exits with an error code."}],"type":"paragraph"},{"syntax":null,"code":["% line-count file1.swift","37","% line-count non-existing-file.swift","Error: The file “non-existing-file.swift” couldn’t be opened because","there is no such file."],"type":"codeListing"},{"inlineContent":[{"text":"If you print your error output yourself, you still need to throw an error from ","type":"text"},{"code":"validate()","type":"codeVoice"},{"type":"text","text":" or "},{"code":"run()","type":"codeVoice"},{"type":"text","text":", so that your command exits with the appropriate exit code. To avoid printing an extra error message, use the "},{"type":"codeVoice","code":"ExitCode"},{"type":"text","text":" error, which has static properties for success, failure, and validation errors, or lets you specify a specific exit code."}],"type":"paragraph"},{"type":"codeListing","syntax":"swift","code":["struct RuntimeError: Error, CustomStringConvertible {","    var description: String","}","","struct Example: ParsableCommand {","    @Argument var inputFile: String","","    mutating func run() throws {","        if !ExampleCore.processFile(inputFile) {","            \/\/ ExampleCore.processFile(_:) prints its own errors","            \/\/ and returns `false` on failure.","            throw ExitCode.failure","        }","    }","}"]},{"level":2,"type":"heading","text":"Handling Transform Errors","anchor":"Handling-Transform-Errors"},{"type":"paragraph","inlineContent":[{"text":"During argument and option parsing, you can use a closure to transform the command line strings to custom types. If this transformation fails, you can throw a ","type":"text"},{"type":"codeVoice","code":"ValidationError"},{"text":"; its ","type":"text"},{"code":"message","type":"codeVoice"},{"text":" property will be displayed to the user.","type":"text"}]},{"inlineContent":[{"type":"text","text":"In addition, you can throw your own errors. Errors that conform to "},{"type":"codeVoice","code":"CustomStringConvertible"},{"type":"text","text":" or "},{"type":"codeVoice","code":"LocalizedError"},{"text":" provide the best experience for users.","type":"text"}],"type":"paragraph"},{"code":["struct ExampleTransformError: Error, CustomStringConvertible {","  var description: String","}","","struct ExampleDataModel: Codable {","  let identifier: UUID","  let tokens: [String]","  let tokenCount: Int","","  static func dataModel(_ jsonString: String) throws -> ExampleDataModel  {","    guard let data = jsonString.data(using: .utf8) else { throw ValidationError(\"Badly encoded string, should be UTF-8\") }","    return try JSONDecoder().decode(ExampleDataModel.self, from: data)","  }","}","","struct Example: ParsableCommand {","  \/\/ Reads in the argument string and attempts to transform it to","  \/\/ an `ExampleDataModel` object using the `JSONDecoder`. If the","  \/\/ string is not valid JSON, `decode` will throw an error and","  \/\/ parsing will halt.","  @Argument(transform: ExampleDataModel.dataModel)","  var inputJSON: ExampleDataModel","","  \/\/ Specifiying this option will always cause the parser to exit","  \/\/ and print the custom error.","  @Option(transform: { throw ExampleTransformError(description: \"Trying to write to failOption always produces an error. Input: \\($0)\") })","  var failOption: String?","}"],"syntax":"swift","type":"codeListing"},{"type":"paragraph","inlineContent":[{"text":"Throwing from a transform closure benefits users by providing context and can reduce development time by pinpointing issues quickly and more precisely.","type":"text"}]},{"syntax":null,"type":"codeListing","code":["% example '{\"Bad JSON\"}'","Error: The value '{\"Bad JSON\"}' is invalid for '<input-json>': dataCorrupted(Swift.DecodingError.Context(codingPath: [], debugDescription: \"The given data was not valid JSON.\", underlyingError: Optional(Error Domain=NSCocoaErrorDomain Code=3840 \"No value for key in object around character 11.\" UserInfo={NSDebugDescription=No value for key in object around character 11.})))","Usage: example <input-json> --fail-option <fail-option>","  See 'select --help' for more information."]},{"inlineContent":[{"type":"text","text":"While throwing standard library or Foundation errors adds context, custom errors provide the best experience for users and developers."}],"type":"paragraph"},{"type":"codeListing","syntax":null,"code":["% example '{\"tokenCount\":0,\"tokens\":[],\"identifier\":\"F77D661C-C5B7-448E-9344-267B284F66AD\"}' --fail-option=\"Some Text Here!\"","Error: The value 'Some Text Here!' is invalid for '--fail-option <fail-option>': Trying to write to failOption always produces an error. Input: Some Text Here!","Usage: example <input-json> --fail-option <fail-option>","  See 'select --help' for more information."]}]}],"variants":[{"traits":[{"interfaceLanguage":"swift"}],"paths":["\/documentation\/argumentparser\/validation"]}],"identifier":{"interfaceLanguage":"swift","url":"doc:\/\/ArgumentParser\/documentation\/ArgumentParser\/Validation"},"references":{"doc://ArgumentParser/documentation/ArgumentParser/ParsableArguments":{"identifier":"doc:\/\/ArgumentParser\/documentation\/ArgumentParser\/ParsableArguments","title":"ParsableArguments","abstract":[{"type":"text","text":"A type that can be parsed from a program’s command-line arguments."}],"kind":"symbol","url":"\/documentation\/argumentparser\/parsablearguments","role":"symbol","type":"topic","fragments":[{"text":"protocol","kind":"keyword"},{"text":" ","kind":"text"},{"kind":"identifier","text":"ParsableArguments"}],"navigatorTitle":[{"kind":"identifier","text":"ParsableArguments"}]},"doc://ArgumentParser/documentation/ArgumentParser/ParsableCommand":{"title":"ParsableCommand","type":"topic","abstract":[{"text":"A type that can be executed as part of a nested tree of commands.","type":"text"}],"role":"symbol","fragments":[{"kind":"keyword","text":"protocol"},{"kind":"text","text":" "},{"text":"ParsableCommand","kind":"identifier"}],"navigatorTitle":[{"kind":"identifier","text":"ParsableCommand"}],"identifier":"doc:\/\/ArgumentParser\/documentation\/ArgumentParser\/ParsableCommand","kind":"symbol","url":"\/documentation\/argumentparser\/parsablecommand"},"doc://ArgumentParser/documentation/ArgumentParser/ValidationError":{"title":"ValidationError","type":"topic","abstract":[{"text":"An error type that is presented to the user as an error with parsing their","type":"text"},{"type":"text","text":" "},{"text":"command-line input.","type":"text"}],"role":"symbol","fragments":[{"text":"struct","kind":"keyword"},{"text":" ","kind":"text"},{"text":"ValidationError","kind":"identifier"}],"navigatorTitle":[{"text":"ValidationError","kind":"identifier"}],"identifier":"doc:\/\/ArgumentParser\/documentation\/ArgumentParser\/ValidationError","kind":"symbol","url":"\/documentation\/argumentparser\/validationerror"},"doc://ArgumentParser/documentation/ArgumentParser/CleanExit":{"title":"CleanExit","type":"topic","abstract":[{"text":"An error type that represents a clean (i.e. non-error state) exit of the","type":"text"},{"type":"text","text":" "},{"type":"text","text":"utility."}],"role":"symbol","fragments":[{"kind":"keyword","text":"struct"},{"text":" ","kind":"text"},{"text":"CleanExit","kind":"identifier"}],"navigatorTitle":[{"text":"CleanExit","kind":"identifier"}],"identifier":"doc:\/\/ArgumentParser\/documentation\/ArgumentParser\/CleanExit","kind":"symbol","url":"\/documentation\/argumentparser\/cleanexit"},"doc://ArgumentParser/documentation/ArgumentParser/ExitCode":{"title":"ExitCode","type":"topic","abstract":[{"type":"text","text":"An error type that only includes an exit code."}],"role":"symbol","fragments":[{"text":"struct","kind":"keyword"},{"text":" ","kind":"text"},{"text":"ExitCode","kind":"identifier"}],"navigatorTitle":[{"text":"ExitCode","kind":"identifier"}],"identifier":"doc:\/\/ArgumentParser\/documentation\/ArgumentParser\/ExitCode","kind":"symbol","url":"\/documentation\/argumentparser\/exitcode"},"doc://ArgumentParser/documentation/ArgumentParser":{"title":"ArgumentParser","role":"collection","abstract":[{"type":"text","text":"Straightforward, type-safe argument parsing for Swift."}],"identifier":"doc:\/\/ArgumentParser\/documentation\/ArgumentParser","kind":"symbol","type":"topic","url":"\/documentation\/argumentparser"},"doc://ArgumentParser/documentation/ArgumentParser/ParsableArguments/validate()-5r0ge":{"url":"\/documentation\/argumentparser\/parsablearguments\/validate()-5r0ge","type":"topic","abstract":[{"type":"text","text":"Validates the properties of the instance after parsing."}],"title":"validate()","required":true,"identifier":"doc:\/\/ArgumentParser\/documentation\/ArgumentParser\/ParsableArguments\/validate()-5r0ge","defaultImplementations":1,"kind":"symbol","fragments":[{"kind":"keyword","text":"func"},{"kind":"text","text":" "},{"text":"validate","kind":"identifier"},{"text":"() ","kind":"text"},{"kind":"keyword","text":"throws"}],"role":"symbol"}}}